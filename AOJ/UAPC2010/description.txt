
Problem C: Accelerated Railgun

宙に舞うコインは放物線を描き、彼女はそれを紫電を纏った彼女の指先で受け止めた。彼女は超能力者である。それも、その都市にいる100万人を越える超能力者たちの中でも三本の指に入る電撃使いだ。親指に弾かれたコインは電磁力によって加速され、フレミングの左手の法則に従い射出される。その初速は、彼女が手加減した上でさえ音速の三倍を越える。そのような高速で射出されると、コインは空気摩擦と断熱圧縮によって加熱され、溶けてオレンジ色に輝くのだ。これが彼女の得意技、超電磁砲
(レールガン) である。その威力はコンクリートの壁に直径2メートルの穴を開けるほどである。

彼女はその能力を使って、しばしばこの都市にはびこる悪、郵便局強盗や銀行強盗などを退治してきていた。そして今日は、非人道的な人体実験を行う研究所があると聞き付けたので、彼女はそれを破壊することにした。彼女の超電磁砲だけがそれを撃ち抜くことができるのである。

コインを使った超電磁砲では威力が足りず、その研究所の建物を破壊することができない。彼女は近くに手頃な鎧が落ちているのを見つけたので、それをプロジェクタイルとして使うことにした。しかしながら、鎧はコインに比べてずっと大きく重いので、簡単に狙いを定めて打つことができない。彼女にできるのは、鎧を今ある場所から決められた速度ベクトルで射出することのみである。研究所の位置によっては、超電磁砲は直撃せずにただの花火になってしまう。

そこで彼女は、その都市の最も強力な超能力者に協力してもらうことにした。彼はその超能力の数限りない応用の一つとして、運動する物体の向きを変えることができる。ここで、研究所を原点とした2次元平面を考えよう。彼女はプロジェクタイルを
P = (px, py) から速度ベクトル V = (vx, vy) で発射する。彼の超能力は、原点を中心とする半径 R
の円周状の仮想的な壁を作る。その壁に触れたプロジェクタイルは (入射角) = (反射角) となるように跳ね返るのである。

空気抵抗によって速度が落ちたり、熱によってプロジェクタイルが完全に溶けたりするために、超電磁砲の射程距離は D
に限られている。この条件のもとで、超電磁砲が命中するかどうかを判定するプログラムを書いてほしい。研究所と鎧の大きさは無視できるほど小さく、発射された超電磁砲が再度
P を通過しても構わないものとする。

Input
各データセットは、5つの実数を含む1行からなる。これらはそれぞれ、px, py, vx, vy, D を表す。

Output
超電磁砲が命中するならば、命中するまでに進んだ距離を出力せよ。そうでなければ、'impossible' と出力せよ。
ジャッジデータには、答えが (D - eps) 以上となるような入力は無いことが保証されている。


Problem E: Huge Family

Dango氏の家は想像を絶する大家族である。昔はおよそ100人の家族だったのだが、今では一つの街を作れるほど巨大になり、もうすぐこの星を埋め尽くすのではないか、なんていう冗談も囁かれている。彼らは皆穏やかで優しい性格をしていて、家族全員仲良しである。

彼らは全員携帯電話を使って連絡を取り合っている。もちろん、全員揃って家族割引に加入している。この家族割引は以下のようなものである。a 氏が
b 氏を、b 氏が a 氏を相手に指定すると家族割引が適用でき、その2人の間では単位時間あたりの通話料が普通より安い f(i, j)
円になる。それぞれの人は最大2回まで家族割引を適用することができるが、同じ2人組が2回適用することは許されない。そして今、適切に相手を選んだので、Dango一家の全員が家族割引を2回適用している。

なにしろ人数が多いので、家族全員に電話を使って連絡をすることはとても大変である。Dango氏は、家族割引を使って clan
という連絡網を作ることを考えた。clan の定義を以下に示そう。

clan とは、家族割引を適用しているペアの部分集合 S のうち、以下のようなものである。
1. どんな2人 (仮に i氏、j氏とする) に対しても、i氏から家族割引が適用された通話のみを経由して (直接、あるいは間接的に)
j氏に連絡を取ることができるならば、i氏から S に含まれるペア間の通話のみを経由して (直接、あるいは間接的に)
j氏に連絡をとることができる。
2. 条件 1 を満たした上で、S に含まれるペア間の単位時間あたりの通話料の和が最小になる。

clan を使うことで、より効率的に連絡が行えるようになる。例えば、全ての人が「clan に含まれる相手から連絡が着たならば、他の全ての
clan に含まれる相手にその連絡を伝える」という単純なルールに従ったとき、家族割引を適用された通話のみを経由して連絡を取れる全ての人に必ずその連絡が行き渡ることと、その連絡が同じ人のところに2回以上回ってこないことが証明できる。

さて、あなたにはDango一家の家族割引の適用状況に関する情報が与えられる。何通りの異なる clan
を作ることができるか計算するプログラムを作成してほしい。答えは非常に大きくなりうるので、 mod 10007 で出力せよ。

Input
各テストケースの最初の行には、家族の人数 n (3 <= n <= 100,000) が与えられる。
続く n 行のうち i 行目には i 番目の人に関する情報が与えられ、各行は4つの整数を含む。
最初の2つの数はそれぞれ、家族割引の相手 b[0] と、その相手に対する単位時間あたりの通話料 f(i, b[0]) を表す。
続く2つの数も同様に、b[1] と f(i, b[1]) を表す。

Output
clan の数を mod 10007 で出力せよ。



Problem H: Winter Bells

世界で一番とびっきりの夜がやってきた。12月24日午後8時。そう、クリスマスイブの夜である。寝静まった街に、鈴の音を鳴らしながらサンタクロースはやってくる。トナカイのソリに引かれて、北風を追い越し、子供たちの眠る窓辺に吊るされた靴下にプレゼントを撃ち込むのだ。

サンタクロースの乗るソリは、街の外れにある大きなクリスマスツリーから出発する。このクリスマスツリーが生み出す奇跡の力は街の上空に網目のように広がり、ソリが通れるような道を作るのだ。奇跡の力が濃い所ほど通りやすいので、これらの道は重み付き無向グラフとして表すことができる。

サンタクロースにとってプレゼントの配達は、極めて厳しい時間との戦いである。夜明けが近づいてくると奇跡の力は急激に弱まり、サンタクロースは配達を続けられなくなってしまう。そんなことはサンタクロースのプライドが許さないので、何としてもそれまでに配達を住ませなければならないのだ。

トナカイの引くソリは、クリスマスツリー (0番目の頂点に対応する) を出発し、街の反対側 (n-1番目の頂点にに対応する)
まで最短経路を通って滑空する。サンタクロースはトナカイが全力で引くソリの上から、奇跡の力をプレゼントに変えて撃ち込むのだ。もし2つ以上の最短経路があった場合、トナカイは全ての最短経路の中から等確率で一つを選び、それに沿ってソリを走らせる。

さて、この街には p 人の子供たちがいて、サンタクロースを一目見たいと思いながら、自分の部屋の窓から夜空を見上げている。i
番目の子供の家の上空には、グラフの c[i]
番目の頂点に対応するような奇跡の力の交差点があり、その子供はその頂点をサンタクロースが通過した場合 (また、その場合に限って)
サンタクロースを見ることができる。

それぞれの子供がサンタクロースを見られる確率はいくらだろうか？

Input
各データセットの最初の行には3つの整数 n, m, p
が与えられる。これらはそれぞれ、グラフの頂点の数、辺の数、そして子供の数を表す。各頂点には 0 から n-1 の番号が付けられている。
続く m 行には辺の情報が与えられる。各行には3つの整数が与えられ、最初の2つの数字はその辺の両端の頂点を、3つ目の数字はその辺の重みを表す。
その次の行には p 個の整数が与えられ、それぞれ c[i] を表す。

Output
確率を表す p 個の実数値を、入力と同じ順番で出力せよ。その後に1行の空行を出力せよ。
小数点以下何桁でも出力してよく、出力される数は1.0e-6以下の誤差を含んでいても構わない。
